<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>我的流程模型12</title>
    <th:block th:replace="Fragment/GeneralLib::WorkFlowRuntimeLib"></th:block>
    <th:block th:replace="Fragment/GeneralLib::ThemesLib"></th:block>
    <th:block th:replace="Fragment/GeneralLib::LineAwesomeLib"></th:block>
    <style>
        .model{
            padding: 20px;
            margin: 10px;
            border: #0F74A8 1px solid;
            border-radius: 8px;
            cursor: pointer;
        }
        .model-group-outer-wrap{
            border: #f2b17c 0px solid;
            border-radius: 8px;
        }
        .model-group-inner-wrap{
            border-left: #1B4F72 1px dashed;
            border-radius: 2px;
            margin: 8px 8px 16px 8px;
        }
        .model-group-name-wrap{
            padding: 8px;
        }
        .model-group-name{
            color: red;
        }
        .model-group-child-outer-wrap{
            border: #20562f 0px solid;
            border-radius: 8px;
            margin: 8px 8px 8px 16px;
        }
        .model-single-outer-wrap{
            display: inline-block;
            margin: 8px;
            border: #f2b17c solid 1px;
            padding: 6px;
            border-radius: 4px;
            width: 256px;
            cursor: pointer;
        }
        .model-single-outer-wrap:hover{
            background-color: #f3e3d6;
        }
        .model-caption {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .las,.lab{
            font-size: 36px;
        }
    </style>
</head>
<body>
<div id="appForm" class="general-edit-page-wrap" v-cloak>
    <!--<div v-for="item in models" class="model" @click="startNewInstance(item)">
        <div>{{item.modelName}}</div>
    </div>-->
    <div style="float: right;margin-right: 10px">
        <i-input search placeholder="请输入要查找的流程名称" style="width: 300px;margin-right: 10px" v-model="searchModelName"></i-input>
        <button-group>
            <i-button type="primary" icon="md-checkmark" @click="searchModel()">查找</i-button>
            <i-button icon="md-close" @click="resetSearchModel()">重置</i-button>
        </button-group>
    </div>
    <div v-if="modelIntegratedEntityList.length==0">无相关流程模型</div>
    <div class="model-group-outer-wrap model-group-child-outer-wrap" id="modelGroupOuterWrap">
        <!--<div class="model-group-inner-wrap">
            <div class="model-group-name-wrap"><i class="las la-campground"></i>标题</div>
            <div class="model-list-outer-wrap">
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程</div>
                </div>
                <div class="model-single-outer-wrap">
                    <i class="las la-campground"></i>
                    <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                </div>
            </div>
            <div class="model-group-child-outer-wrap">&lt;!&ndash;子分组&ndash;&gt;
                <div class="model-group-inner-wrap">
                    <div class="model-group-name-wrap"><i class="las la-campground"></i>标题</div>
                    <div class="model-list-outer-wrap">
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                    </div>
                </div>
                <div class="model-group-inner-wrap">
                    <div class="model-group-name-wrap"><i class="las la-campground"></i>标题</div>
                    <div class="model-list-outer-wrap">
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程网关并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程</div>
                        </div>
                        <div class="model-single-outer-wrap">
                            <i class="las la-campground"></i>
                            <div class="model-caption">运维问题处理流程-并行网关并行网关并行网关</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>-->
    </div>
</div>
<script>

    let appForm = new Vue({
        el:"#appForm",
        data: {
            menuId:BaseUtility.GetUrlParaValue("menuId"),
            acInterface:{
                getMyBootableModel:"/Rest/Workflow/RunTime/Client/ModelRuntime/GetMyBootableModelWithSSOMenu",
                //getMyBootableModel:"/Rest/Workflow/RunTime/Client/ModelRuntime/GetMyBootableModel",
                startInstanceView: "/JB4DCBuilderClient/HTML/WorkFlow/Runtime/MyBootableInstanceStart.html"
            },
            models:[],
            modelGroupEntityJson:[],
            modelGroupRefEntityList:[],
            modelIntegratedEntityList:[],
            searchModelName:"",
        },
        mounted:function () {
            AjaxUtility.Get(this.acInterface.getMyBootableModel,{
                menuId:this.menuId
            },function (result){
                //console.log(result);
                this.models=result.data.modelIntegratedEntityList;

                this.modelGroupEntityJson=JsonUtility.ParseArrayJsonToTreeJson({
                    KeyField: "modelGroupId",
                    RelationField: "modelGroupParentId",
                    ChildFieldName: "datas"
                }, result.data.modelGroupEntityList, "0");
                this.modelGroupRefEntityList=result.data.modelGroupRefEntityList;
                this.modelIntegratedEntityList=result.data.modelIntegratedEntityList;

                //console.log(this.modelGroupEntityJson);
                //console.log(this.modelGroupRefEntityList);
                //console.log(this.modelIntegratedEntityList);
                this.buildModelPage("");
            },this);
        },
        methods: {
            searchModel(){
                this.buildModelPage(this.searchModelName);
                //console.log(this.searchModelName);
            },
            resetSearchModel(){
                this.searchModelName="";
                this.searchModel();
            },
            startNewInstance(modelId) {
                let modelPO = ArrayUtility.WhereSingle(this.modelIntegratedEntityList, function (item) {
                    return item.modelId == modelId;
                });
                let url = BaseUtility.BuildView(this.acInterface.startInstanceView, {
                    modelId: modelPO.modelId,
                    modelKey: modelPO.modelReKey
                });
                DialogUtility.Frame_OpenIframeWindow(window, DialogUtility.DialogWorkFlowFormId, url, {
                    title: "发起[" + modelPO.modelName + "]"
                }, 0, false);
            },
            buildModelPage(searchModelName){
                //debugger;
                let $modelGroupOuterWrap=$("#modelGroupOuterWrap");
                $modelGroupOuterWrap.html("");
                this.loopBuildChild(this.modelGroupEntityJson,$modelGroupOuterWrap,searchModelName);
                this.hiddenEmptyModelGroup();
            },
            hiddenEmptyModelGroup(){
                let allParentGroup=$(".model-group-inner-wrap");
                for (let i = 0; i < allParentGroup.length; i++) {
                    if($(allParentGroup[i]).find(".model-single-outer-wrap").length==0){
                        $(allParentGroup[i]).hide();
                    }
                }
            },
            loopBuildChild(parentGroup,$parentElem,searchModelName) {
                for (let i = 0; i < parentGroup.datas.length; i++) {
                    let singleGroup = parentGroup.datas[i];
                    let $modelGroupInnerWrap = $("<div class='model-group-inner-wrap'><div class='model-group-name-wrap'><i class='" + singleGroup.modelGroupClassName + "'></i><span class='model-group-name'>【" + singleGroup.modelGroupText + "】</span></div><div class='model-list-outer-wrap'></div></div>");
                    let $modelListOuterWrap = $modelGroupInnerWrap.find(".model-list-outer-wrap");
                    $parentElem.append($modelGroupInnerWrap);

                    let models = this.findRefModel(singleGroup.modelGroupId);
                    if(models&&models.length>0&&searchModelName!="") {
                        //debugger;
                        models = ArrayUtility.Where(models, function (item) {
                            return item.modelName.indexOf(searchModelName) >= 0;
                        });
                    }
                    if (models) {
                        for (let j = 0; j < models.length; j++) {
                            //console.log(models);
                            let modelElem = $("<div class=\"model-single-outer-wrap\" onclick=\"appForm.startNewInstance('"+models[j].modelId+"')\">" +
                                "<i class=\"" + models[j].modelImageClass + "\"></i>" +
                                "<div class=\"model-caption\">" + models[j].modelName + "</div>" +
                                "</div>");
                            //console.log(models[j].modelName);
                            $modelListOuterWrap.append(modelElem);
                        }
                    }

                    if (singleGroup.datas && singleGroup.datas.length > 0) {
                        let $modelGroupChildOuterWrap = $("<div class='model-group-child-outer-wrap'></div>");
                        $modelGroupInnerWrap.append($modelGroupChildOuterWrap);
                        this.loopBuildChild(singleGroup, $modelGroupChildOuterWrap,searchModelName);
                    }
                }
            },
            findRefModel(groupId) {
                let modelRefs = ArrayUtility.Where(this.modelGroupRefEntityList, function (item) {
                    return item.grefGroupId == groupId;
                });
                let models = ArrayUtility.Where(this.modelIntegratedEntityList, function (model) {
                    //debugger;
                    return ArrayUtility.Exist(modelRefs, function (ref) {
                        return model.modelReKey == ref.grefModelKey;
                    })
                });
                return models;
            }
        }
    });
</script>
</body>
</html>