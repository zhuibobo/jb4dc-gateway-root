<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title1</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../../../../Js/External/JQuery-3.4.1/jquery-3.4.1.min.js"></script><script type="text/javascript" src="../../../../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../../../../Js/External/IView-4.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.js"></script><script type="text/javascript" src="../../../../../../Js/JBuild4DCLib.js?refVersion=1630998434799"></script><script type="text/javascript" src="../../../../../../Js/UIEXComponent.js?refVersion=1630998434799"></script><script type="text/javascript" src="../../../../../../Js/VueEXComponent.js?refVersion=1630998434799"></script><script type="text/javascript" src="../../../../../../JB4DCBuilder/Js/UIEXComponentForBuilder.js?refVersion=1630998434799"></script><script type="text/javascript" src="../../../../../../JB4DCBuilder/Js/BuilderVueEXComponent.js?refVersion=1630998434799"></script><script type="text/javascript" src="../../../../../../JB4DCBuilder/Js/HTMLDesign/HTMLDesignUtility.js?refVersion=1630998434799"></script><link rel="stylesheet" type="text/css" href="../../../../../../Themes/Default/IView-4.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../../../../Themes/Default/JQueryUI/jquery-ui-important.css"><link rel="stylesheet" type="text/css" href="../../../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="../../../../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><link rel="stylesheet" type="text/css" href="../../../../../../Themes/Default/Css/JBuild4DC.css?refVersion=1630998434799"><link rel="stylesheet" type="text/css" href="../../../../../../JB4DCBuilder/Themes/Default/Css/JBuild4DCBuilder.css?refVersion=1630998434799"><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/Css/HTMLDesignRuntimeMain.css?refVersion=2"></head><body><div class="html-design-plugin-dialog-wraper" id="dialogApp" v-cloak><tabs size="small"><tab-pane label="绑定信息"><table class="html-design-plugin-dialog-table-wraper" cellpadding="0" cellspacing="0" border="0"><colgroup><col style="width:120px"><col style="width:240px"><col style="width:90px"><col style="width:120px"><col style="width:90px"><col></colgroup><tbody><tr><td>触发按钮：</td><td><i-select v-model="normalProps.targetButtonId" style="width:230px" :clearable="true" @on-change="changeTargetButton"><i-option :value="item.buttonId" v-for="item in buttons">{{item.buttonCaption}}</i-option></i-select></td><td>标题：</td><td colspan="3"><input type="text" v-model="normalProps.caption"></td></tr><tr><td>选定图标：</td><td colspan="5"><div class="wldct-list-table-row-button-wrap"><div :class="normalProps.selectedClass"></div></div></td></tr><tr><td>可选图标：</td><td colspan="5"><div class="wldct-list-table-row-button-wrap"><div class="wldct-list-table-row-inner-button view" @click="changeSelectedClass('view')"></div><div class="wldct-list-table-row-inner-button edit" @click="changeSelectedClass('edit')"></div><div class="wldct-list-table-row-inner-button del" @click="changeSelectedClass('del')"></div><div class="wldct-list-table-row-inner-button selected" @click="changeSelectedClass('selected')"></div><div class="wldct-list-table-row-inner-button listmanager" @click="changeSelectedClass('listmanager')"></div><div class="wldct-list-table-row-inner-button edit-model" @click="changeSelectedClass('edit-model')"></div><div class="wldct-list-table-row-inner-button view-model" @click="changeSelectedClass('view-model')"></div><div class="wldct-list-table-row-inner-button move-up" @click="changeSelectedClass('move-up')"></div><div class="wldct-list-table-row-inner-button move-down" @click="changeSelectedClass('move-down')"></div><div class="wldct-list-table-row-inner-button kded" @click="changeSelectedClass('kded')"></div><div class="wldct-list-table-row-inner-button grade" @click="changeSelectedClass('grade')"></div><div class="wldct-list-table-row-inner-button image-cultured" @click="changeSelectedClass('image-cultured')"></div><div class="wldct-list-table-row-inner-button page-white-edit" @click="changeSelectedClass('page-white-edit')"></div><div class="wldct-list-table-row-inner-button page-attach" @click="changeSelectedClass('page-attach')"></div><div class="wldct-list-table-row-inner-button page-go" @click="changeSelectedClass('page-go')"></div><div class="wldct-list-table-row-inner-button script-key" @click="changeSelectedClass('script-key')"></div><div class="wldct-list-table-row-inner-button wrench-orange" @click="changeSelectedClass('wrench-orange')"></div><div class="wldct-list-table-row-inner-button x-office-document-template" @click="changeSelectedClass('x-office-document-template')"></div><div class="wldct-list-table-row-inner-button x-office-drawing" @click="changeSelectedClass('x-office-drawing')"></div><div class="wldct-list-table-row-inner-button kjobviewer" @click="changeSelectedClass('kjobviewer')"></div></div></td></tr><tr><td>提示信息：</td><td colspan="5"><input type="text" v-model="normalProps.alertMsg"></td></tr><tr><td>显示条件：</td><td colspan="5"><input type="text" v-model="normalProps.displayCondition"><div class="eg-message">eg:record.字段=="是1"</div></td></tr><tr><td>显示条件方法：</td><td colspan="5"><input type="text" v-model="normalProps.displayConditionFunc"></td></tr></tbody></table></tab-pane><tab-pane label="基础信息"><fd-control-base-info v-model="baseInfo"></fd-control-base-info></tab-pane><tab-pane label="开发扩展"><table cellpadding="0" cellspacing="0" border="0" class="html-design-plugin-dialog-table-wraper"><colgroup><col style="width:150px"><col></colgroup><tbody><tr><td>服务端解析类：</td><td><i-input v-model="normalProps.custServerResolveMethod" placeholder="按钮进行服务端解析时,保存模版时候调用,类全称,需要实现接口IListTableLabelCustResolve"></td></tr><tr><td>参数：</td><td><i-input v-model="normalProps.custServerResolveMethodPara" placeholder="服务端解析类的参数"></td></tr><tr><td>客户端渲染方法：</td><td><i-input v-model="normalProps.custClientRendererMethod" placeholder="客户端渲染方法,生成前端页面时调动,最终形成页面元素,需要返回最终元素的HTML对象"></td></tr><tr><td>参数：</td><td><i-input v-model="normalProps.custClientRendererMethodPara" placeholder="客户端渲染方法的参数"></td></tr></tbody></table></tab-pane></tabs></div><script>var DialogApp=new Vue({
            el:"#dialogApp",
            data: {
                baseInfo:CKEditorPluginUtility.DefaultProps.baseInfo,
                defaultValue: CKEditorPluginUtility.DefaultProps.defaultValue,
                normalProps:{
                    targetButtonId:"",
                    selectedClass:"wldct-list-table-row-inner-button view",
                    caption:"",
                    alertMsg:"",
                    displayCondition:"",
                    displayConditionFunc:"",
                    //开发扩展
                    custServerResolveMethod:"",
                    custServerResolveMethodPara:"",
                    custClientRendererMethod:"",
                    custClientRendererMethodPara:""
                },
                dataSetId:null,
                buttons:[]
            },
            mounted:function () {

            },
            methods: {
                ready:function(actionName,sel,parents){
                    //debugger;
                    this.baseInfo.id="btn_lt_inner_"+StringUtility.Timestamp();
                    this.baseInfo.name=this.baseInfo.id;

                    this.dataSetId=CKEditorPluginUtility.TryGetDataSetId(sel,parents);
                    this.buttons=CKEditorPluginUtility.TryGetListButtonsInPluginPage();

                    //this.bindDataSetFieldTree();
                },
                bindDataSetFieldTree:function(){
                    /*if(this.dataSetId){
                        var dataSetPO=window.parent.listDesign.getDataSet(this.dataSetId);
                        this.$refs.listTableLabelBindToComp.init(dataSetPO,this.buttons);
                    }
                    else {
                        DialogUtility.AlertText("请先设定DataSet");
                    }*/
                },
                getControlProps:function () {
                    //var bindData=this.$refs.listTableLabelBindToComp.getData();
                    //for(var key in this.normalProps)
                    if(this.normalProps.targetButtonId==""){
                        DialogUtility.AlertText("请设定触发的按钮!1");
                        return {success: false};
                    }
                    var result = {
                        success: true,
                        baseInfo: this.baseInfo,
                        normalProps:{
                            targetButtonId:this.normalProps.targetButtonId,
                            selectedClass:this.normalProps.selectedClass,
                            caption:this.normalProps.caption,
                            alertMsg:this.normalProps.alertMsg,
                            displayCondition:this.normalProps.displayCondition,
                            displayConditionFunc:this.normalProps.displayConditionFunc,
                            //开发扩展
                            custServerResolveMethod:this.normalProps.custServerResolveMethod,
                            custServerResolveMethodPara:this.normalProps.custServerResolveMethodPara,
                            custClientRendererMethod:this.normalProps.custClientRendererMethod,
                            custClientRendererMethodPara:this.normalProps.custClientRendererMethodPara
                        }
                    }
                    return result;
                },
                setControlProps:function ($elem,props) {
                    //debugger;
                    //console.log(props);
                    this.baseInfo = props.baseInfo ? props.baseInfo : this.baseInfo;
                    //this.bindToSearchField = props.bindToSearchField ? props.bindToSearchField : this.bindToSearchField;
                    this.defaultValue = props.defaultValue ? props.defaultValue : this.defaultValue;


                    this.normalProps.targetButtonId=$elem.attr("targetbuttonid");
                    this.normalProps.selectedClass=$elem.attr("selectedClass");
                    this.normalProps.selectedClass=$elem.attr("selectedClass");
                    this.normalProps.caption=$elem.attr("caption");
                    this.normalProps.displayCondition=$elem.attr("displayCondition");
                    this.normalProps.displayConditionFunc=$elem.attr("displayConditionFunc");

                    this.normalProps.custServerResolveMethod =$elem.attr("custserverresolvemethod");
                    this.normalProps.custServerResolveMethodPara = $elem.attr("custserverresolvemethodpara");
                    this.normalProps.custClientRendererMethod =$elem.attr("custclientrenderermethod");
                    this.normalProps.custClientRendererMethodPara = $elem.attr("custclientrenderermethodpara");

                    //this.$refs.listTableLabelBindToComp.setData(this.normalProps,this.defaultValue);
                },
                changeSelectedClass:function (className) {
                    this.normalProps.selectedClass="wldct-list-table-row-inner-button "+className;
                },
                changeTargetButton:function (buttonId) {
                    //console.log(this.buttons);
                    for(var i=0;i<this.buttons.length;i++){
                        var item=this.buttons[i];
                        if(item.buttonId==buttonId){
                            //console.log(item);
                            if(item.buttonCaption=="修改"){
                                this.changeSelectedClass("edit");
                                this.normalProps.caption="修改";
                            }
                            else if(item.buttonCaption=="查看"){
                                this.changeSelectedClass("view");
                                this.normalProps.caption="查看";
                            }
                            else if(item.buttonCaption=="删除"){
                                this.changeSelectedClass("del");
                                this.normalProps.caption="删除";
                            }
                            else if(item.buttonCaption=="处理"){
                                this.changeSelectedClass("page-white-edit");
                                this.normalProps.caption="处理";
                            }
                            break;
                        }
                    }
                }
            }
        });</script></body></html>