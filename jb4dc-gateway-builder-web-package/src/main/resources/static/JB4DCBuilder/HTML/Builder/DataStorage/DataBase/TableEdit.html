<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>Title</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../../../Js/External/JQuery-3.6.0/jquery-3.6.0.min.js"></script><script type="text/javascript" src="../../../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../../../Js/External/IView-4.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.js"></script><script type="text/javascript" src="../../../../../Js/JBuild4DCLib.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../../Js/UIEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../../Js/VueEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../../JB4DCBuilder/Js/UIEXComponentForBuilder.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../../JB4DCBuilder/Js/BuilderVueEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../../SSOSystem/Js/SSOVueEXComponent.js?refVersion=1634822284356"></script><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/IView-4.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/JQueryUI/jquery-ui-important.css"><link rel="stylesheet" type="text/css" href="../../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><link rel="stylesheet" type="text/css" href="../../../../../Themes/Default/Css/JBuild4DC.css?refVersion=1634822284356"><link rel="stylesheet" type="text/css" href="../../../../../JB4DCBuilder/Themes/Default/Css/JBuild4DCBuilder.css?refVersion=1634822284356"></head><body><div id="tableDesion" v-cloak class="general-edit-page-wrap"><spin size="large" fix v-if="isSubmitting"></spin><div class="list-2column"><div class="left-outer-wrap" style="bottom:50px;right:350px"><tabs><tab-pane label="表字段"><div style="width:98%;margin:auto"><div style="float:right;margin-bottom:8px" v-if="status!='view'">忽略物理表修改错误: &nbsp;<i-switch size="small" v-model="ignorePhysicalError"></i-switch>&nbsp;<i-select v-model="useTemplateName" size="small" style="width:200px" @on-change="changeFieldsTemplate"><i-option v-for="(item,key) in templateFieldGroup" :value="key" :key="key">使用模版:{{key}}</i-option></i-select>&nbsp;<button-group><i-button size="small" type="success" icon="md-add" @click="addField"></i-button><i-button size="small" type="primary" icon="md-close" @click="removeField"></i-button><i-button size="small" type="primary" icon="ios-arrow-up" @click="moveField('up')"></i-button><i-button size="small" type="primary" icon="ios-arrow-down" @click="moveField('down')"></i-button></button-group></div><div style="clear:bottom"></div></div><div id="divEditTable" class="edit-table-wrap" style="height:100px;overflow:auto;width:98%;margin:auto"></div></tab-pane><tab-pane label="关联设置"></tab-pane></tabs></div><div class="right-outer-wrap" style="bottom:50px;width:340px;padding:10px"><divider orientation="left" :dashed="true" style="font-size:12px;padding:10px;margin-top:7px">表信息</divider><i-form :model="tableEntity" :label-width="65" style="margin-right:10px"><form-item label="标题：" prop=""><i-input v-model="tableEntity.tableCaption"></i-input></form-item><form-item label="表名：" prop=""><i-input v-model="tableEntity.tableName"></i-input></form-item><form-item label="创建人："><row><i-col span="6"><i-input v-model="tableEntity.tableCreator"></i-input></i-col><i-col span="8" style="text-align:center">创建时间：</i-col><i-col span="10"><form-item><date-picker type="date" placeholder="选择创建时间" v-model="tableEntity.tableCreateTime" disabled="disabled" readonly="readonly" style="width:100%"></date-picker></form-item></i-col></row></form-item><form-item label="修改人："><row><i-col span="6"><i-input v-model="tableEntity.tableUpdater"></i-input></i-col><i-col span="8" style="text-align:center">修改时间：</i-col><i-col span="10"><form-item><date-picker type="date" placeholder="选择修改时间" v-model="tableEntity.tableUpdateTime" disabled="disabled" readonly="readonly" style="width:100%"></date-picker></form-item></i-col></row></form-item><form-item label="系统表："><i-input v-model="tableEntity.tableIsSystem" readonly="readonly"></i-input></form-item><form-item label="备注："><i-input v-model="tableEntity.tableDesc" type="textarea" :autosize="{minRows: 5,maxRows: 5}"></i-input></form-item></i-form></div></div><div class="button-outer-wrap"><div class="button-inner-wrap"><button-group v-if="status!='view'"><i-button type="primary" @click="saveEditTable()">保 存</i-button><i-button @click="handleClose()">关 闭</i-button></button-group></div></div><div><select-default-value-dialog @on-selected-default-value="onSelectedDefaultValue" ref="selectDefaultValueDialog"></select-default-value-dialog></div></div><script>var tableDesion=new Vue({el:"#tableDesion",data:{isSubmitting:!1,acInterface:{getDataUrl:"/Rest/Builder/DataStorage/DataBase/Table/GetEditTableData",saveDataUrl:"/Rest/Builder/DataStorage/DataBase/Table/SaveTableEdit"},recordId:BaseUtility.GetUrlParaValue("recordId"),useTemplateName:"通用模版",currUserEntity:null,templateFieldGroup:null,ignorePhysicalError:!1,tablePrefix:"",tableEntity:{tableId:"",tableCaption:"",tableName:"",tableCreateTime:DateUtility.GetCurrentDate(),tableCreator:"",tableUpdateTime:DateUtility.GetCurrentDate(),tableUpdater:"",tableType:"",tableIsSystem:"否",tableDesc:"",tableGroupId:"",tableLinkId:""},editTableObj:null,editTableConfig:{Status:"Edit",DataField:"fieldName",Templates:[{Title:"字段ID",BindName:"fieldId",Renderer:"EditTable_Label",TitleCellClassName:"TitleCell",DefaultValue:{Type:"GUID",Value:0},Hidden:!0},{Title:"字段标题",BindName:"fieldCaption",Renderer:"EditTable_TextBox",TitleCellClassName:"TitleCell",Validate:{Type:"NotEmpty"},Hidden:!1,TitleCellAttrs:{},Style:{width:120}},{Title:"字段名称",BindName:"fieldName",Renderer:"EditTable_FieldName",Validate:{Type:"SQLKeyWord"},DefaultValue:{Type:"Const",Value:"F_"},Style:{width:150},Hidden:!1},{Title:"字段类型",BindName:"fieldDataType",Renderer:"EditTable_SelectFieldType",Hidden:!1,Style:{width:68,textAlign:"center"}},{Title:"字段长度",BindName:"fieldDataLength",Renderer:"EditTable_TextBox",DefaultValue:{Type:"Const",Value:"50"},Style:{width:68,textAlign:"center"},Hidden:!1},{Title:"小数位数",BindName:"fieldDecimalLength",Renderer:"EditTable_TextBox",DefaultValue:{Type:"Const",Value:"0"},Style:{width:68,textAlign:"center"},Hidden:!1},{Title:"是否主键",BindName:"fieldIsPk",Renderer:"EditTable_CheckBox",IsCNValue:!0,DefaultValue:{Type:"Const",Value:"否"},Style:{width:68,textAlign:"center"},Hidden:!1},{Title:"允许为空",BindName:"fieldAllowNull",Renderer:"EditTable_CheckBox",Hidden:!1,IsCNValue:!0,DefaultValue:{Type:"Const",Value:"是"},Style:{width:68,textAlign:"center"}},{Title:"默认值",BindName:"fieldDefaultEntity.fieldDefaultValue",Renderer:"EditTable_SelectDefaultValue",Hidden:!1},{Title:"备注",BindName:"fieldDesc",Renderer:"EditTable_TextBox",Style:{width:500},Hidden:!0}],RowIdCreater:function(){},TableClass:"edit-table",RendererTo:"divEditTable",TableId:"TableFields",TableAttrs:{cellpadding:"1",cellspacing:"1",border:"1"}},tableFieldsData:null,status:BaseUtility.GetUrlParaValue("op"),groupId:BaseUtility.GetUrlParaValue("groupId")},mounted:function(){this.getDataFromServerAndBind(),$("#divEditTable").height($(".right-outer-wrap").height()-85)},methods:{selectDefaultValueDialogBegin:function(e,t){this.$refs.selectDefaultValueDialog.beginSelect(t),this.selectDefaultValueTargetWindow=e},onSelectedDefaultValue:function(e){this.selectDefaultValueTargetWindow.setSelectEnvVariableResultValue(e)},bindData:function(e){this.editTableObj=Object.create(EditTable),1800<PageStyleUtility.GetPageWidth()&&(this.editTableConfig.Templates[9].Hidden=!1),this.editTableObj.Initialization(this.editTableConfig),this.currUserEntity=SessionUtility.GetSessionUserSync(),DetailPageUtility.OverrideObjectValue(tableDesion.tableEntity,e.data),"add"==this.status?(this.tableEntity.tableCreator=this.currUserEntity.userName,this.tableEntity.tableUpdater=this.currUserEntity.userName,this.tableEntity.tableName=e.exKVData.tablePrefix,this.tablePrefix=e.exKVData.tablePrefix,this.templateFieldGroup=e.exKVData.templateFieldGroup,this.editTableObj.LoadJsonData(e.exKVData.templateFieldGroup[this.useTemplateName])):"view"==this.status?(this.editTableObj.SetToViewStatus(),this.editTableObj.LoadJsonData(e.exKVData.tableFieldsData)):(this.editTableObj.LoadJsonData(e.exKVData.tableFieldsData),this.tableEntity.tableUpdater=this.currUserEntity.userName)},getDataFromServerAndBind:function(){var t=this;AjaxUtility.Post(this.acInterface.getDataUrl,{recordId:this.recordId,op:this.status,groupId:this.groupId},function(e){e.success?t.bindData(e):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)},addField:function(){this.editTableObj.AddEditingRowByTemplate()},removeField:function(){this.editTableObj.RemoveRow()},moveField:function(t){var e=this.editTableObj.GetEditRow();if(null!=e){var i=this,a=e.attr("id"),l=this.editTableObj.GetSelectRowDataByRowId(a).fieldId;AjaxUtility.Post("/Rest/Builder/DataStorage/DataBase/Table/Move.do",{recordId:l,type:t},function(e){e.success?DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){"down"==t?i.editTableObj.MoveDown():i.editTableObj.MoveUp()}):DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,null)},this)}},saveEditTable:function(){if(""==this.tableEntity.tableCaption.replace(/(^\s*)|(\s*$)/g,""))return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"表标题不能为空！",null),!1;if(0==/^[a-zA-Z][a-zA-Z0-9_]{0,}$/.test(this.tableEntity.tableName))return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"表名称不能为空且只能是字母、下划线、数字并以字母开头！",null),!1;if(this.tablePrefix==this.tableEntity.tableName)return DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},"不能使用默认的表前缀作为表名！",null),!1;if(this.editTableObj.CompletedEditingRow()){var e={op:this.status,ignorePhysicalError:this.ignorePhysicalError,tableEntityJson:encodeURIComponent(encodeURIComponent(JSON.stringify(this.tableEntity))),fieldVoListJson:encodeURIComponent(encodeURIComponent(JSON.stringify(this.editTableObj.GetSerializeJson()))),groupId:this.groupId};this.isSubmitting=!0,AjaxUtility.Post(this.acInterface.saveDataUrl,e,function(e){DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},e.message,function(){e.success&&(window.OpenerWindowObj.appList.reloadData(),DialogUtility.Frame_CloseDialog(window))})},this)}},handleClose:function(){DialogUtility.Frame_CloseDialog(window)},changeFieldsTemplate:function(e){this.editTableObj.RemoveAllRow(),this.editTableObj.LoadJsonData(this.templateFieldGroup[e])}}})</script></body></html>