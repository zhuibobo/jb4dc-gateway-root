<!DOCTYPE html><html lang="zh" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"><head><meta charset="UTF-8"><title>列表设计</title><title>JBuild4D</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><script type="text/javascript" src="../../../../Js/External/JQuery-3.6.0/jquery-3.6.0.min.js"></script><script type="text/javascript" src="../../../../Js/External/VUE-2.6.10/vue.js"></script><script type="text/javascript" src="../../../../Js/External/IView-4.X/dist/iview.min.js"></script><script type="text/javascript" src="../../../../Js/External/JQuery-UI-1.12.1/jquery-ui.js"></script><script type="text/javascript" src="../../../../Js/External/ZTree-3.5.40/js/jquery.ztree.all.js"></script><script type="text/javascript" src="../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.js"></script><script type="text/javascript" src="../../../../Js/JBuild4DCLib.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../Js/UIEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../Js/VueEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../JB4DCBuilder/Js/UIEXComponentForBuilder.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../JB4DCBuilder/Js/BuilderVueEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../SSOSystem/Js/SSOVueEXComponent.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../Js/External/ZTree-3.5.40/js/jquery.ztree.exhide.js"></script><script type="text/javascript" src="../../../../Js/External/ZTree-3.5.40/js/fuzzysearch.js"></script><script type="text/javascript" src="../../../../Js/External/Clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../../../JB4DCBuilder/Js/External/Ckeditor-4.11.1-4Design/ckeditor.js"></script><script type="text/javascript" src="../../../../JB4DCBuilder/Js/HTMLDesign/HTMLDesignUtility.js?refVersion=1634822284356"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/lib/codemirror.js"></script><link rel="stylesheet" type="text/css" href="../../../../Js/External/Codemirror-5.48.0/lib/codemirror.css"><link rel="stylesheet" type="text/css" href="../../../../Js/External/Codemirror-5.48.0/theme/monokai.css"><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/mode/xml/xml.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/mode/javascript/javascript.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/mode/css/css.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/mode/sql/sql.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/mode/htmlmixed/htmlmixed.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/foldcode.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/foldgutter.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/brace-fold.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/xml-fold.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/markdown-fold.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/comment-fold.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/fold/brace-fold.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/util/formatting.js"></script><link rel="stylesheet" type="text/css" href="../../../../Js/External/Codemirror-5.48.0/addon/fold/foldgutter.css"><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/search/search.js"></script><script type="text/javascript" src="../../../../Js/External/Codemirror-5.48.0/addon/search/searchcursor.js"></script><link rel="stylesheet" type="text/css" href="../../../../Themes/Default/IView-4.X/iview.css"><link rel="stylesheet" type="text/css" href="../../../../Themes/Default/JQueryUI/jquery-ui.css"><link rel="stylesheet" type="text/css" href="../../../../Themes/Default/JQueryUI/jquery-ui-important.css"><link rel="stylesheet" type="text/css" href="../../../../Js/External/Perfect-Scrollbar-V1.4.0/perfect-scrollbar.css"><link rel="stylesheet" type="text/css" href="../../../../Themes/Default/ZTree/zTreeStyle/zTreeStyle.css"><link rel="stylesheet" type="text/css" href="../../../../Themes/Default/Css/JBuild4DC.css?refVersion=1634822284356"><link rel="stylesheet" type="text/css" href="../../../../JB4DCBuilder/Themes/Default/Css/JBuild4DCBuilder.css?refVersion=1634822284356"><style>.cke_button_label{display:inline!important}</style></head><body><div id="listDesign" v-cloak><div style="position:absolute;right:10px;top:6px;z-index:100"><button-group size="small"><i-button icon="md-cloud-done" type="primary" @click="save()">保存并发布</i-button><i-button icon="md-cloud-done" type="primary" @click="saveClose()">发布并关闭</i-button><i-button icon="md-search" type="primary" @click="savePreview()">发布并预览</i-button><i-button icon="md-checkmark" type="primary" @click="validateDesign()">校验列表设置</i-button><i-button icon="md-search" type="primary" @click="savePreview()">历史版本</i-button></button-group></div><tabs @on-click="tabChange" v-model="selectedTabName" name="outer-tabs"><tab-pane tab="outer-tabs" name="Info" label="Info"><div style="width:1024px;margin:auto"><div style="width:500px;height:610px;border:#ddddf1 1px solid;border-radius:4px;padding:10px 20px 10px 10px;float:left"><divider orientation="left" :dashed="true" style="font-size:12px">表单信息</divider><i-form :model="listResourceEntity" :label-width="110"><form-item label="列表名称："><i-input v-model="listResourceEntity.listName" placeholder="请输入列表名称"></i-input></form-item><form-item label="唯一名称："><i-input v-model="listResourceEntity.listSingleName" placeholder="可以为空"></i-input></form-item><form-item label="绑定数据集："><i-input v-model="listResourceEntity.listDatasetName" placeholder=""></i-input></form-item><form-item label="数据集主键字段："><i-input v-model="listResourceEntity.listDatasetPrimaryKey" placeholder=""></i-input></form-item><form-item label="每次解析："><radio-group v-model="listResourceEntity.listEveryTimeResolve" type="button"><radio label="是">是</radio><radio label="否">否</radio></radio-group></form-item><form-item label="每页条数："><input-number v-model="listResourceEntity.listDatasetPageSize"></input-number></form-item><form-item label="主题："><i-select v-model="listResourceEntity.listTheme" @on-change="changeTheme"><i-option v-for="(item,key) in designThemes" :value="item.value" :key="key">{{item.name}}</i-option></i-select>如果风格重新引入CSS则必须在保存后再次打开才生效,或者使用保存并预览功能!</form-item><form-item label="备注：" style="margin-bottom:12px"><i-input v-model="listResourceEntity.listDesc" type="textarea" :autosize="{minRows: 3,maxRows: 3}"></i-input></form-item></i-form></div><div style="width:500px;height:610px;border:#ddddf1 1px solid;border-radius:4px;padding:10px 20px 10px 10px;float:right"><divider orientation="left" :dashed="true" style="font-size:12px">绑定数据集</divider><dataset-simple-select-comp @on-selected-dataset="selectedDataset"></dataset-simple-select-comp></div></div></tab-pane><tab-pane tab="outer-tabs" name="Design" label="Design"><div class="form-design-wraper"><div class="left-wraper" style="right:10px"><textarea name="html_design" id="html_design">
                    </textarea></div></div></tab-pane><tab-pane tab="outer-tabs" name="HTML" label="HTML"><div class="html-design-wraper"><div class="left-wraper code_wraper"><div class="inner"><textarea id="TextAreaHTMLEditor" style="height:99%"></textarea></div></div><div class="right-wraper"><tabs name="html-inner-tabs"><tab-pane tab="html-inner-tabs" label="CodeFragment"><div>Config</div></tab-pane><tab-pane tab="html-inner-tabs" label="Element"><div>Element</div></tab-pane></tabs></div></div></tab-pane><tab-pane tab="outer-tabs" name="JS" label="JS"><div class="js-design-wraper"><div class="left-wraper code_wraper"><div class="inner"><textarea id="TextAreaJsEditor"></textarea></div></div><div class="right-wraper"><tabs name="js-inner-tabs"><tab-pane tab="js-inner-tabs" label="CodeFragment"><js-design-code-fragment ref="jsDesignCodeFragment"></js-design-code-fragment></tab-pane><tab-pane tab="js-inner-tabs" label="Element"><design-html-elem-list ref="designHtmlElemList"></design-html-elem-list></tab-pane></tabs></div></div></tab-pane><tab-pane tab="outer-tabs" name="EXProp" label="EXProp"><div style="width:1024px;margin:auto"><div style="width:1024px;height:615px;border:#ddddf1 1px solid;border-radius:4px;padding:10px 20px 10px 10px"><divider orientation="left" :dashed="true" style="font-size:12px">扩展信息</divider><i-form :label-width="150"><form-item label="服务端渲染方法："><i-input v-model="listResourceEntity.listCustServerRenderer" placeholder="服务端自定义的渲染方法:继承IFormSeverRenderer"></i-input></form-item><form-item label="客户端渲染方法："><i-input v-model="listResourceEntity.listCustClientRenderer" placeholder="客户端自定义的渲染方法:需要指明具体的方法名称"></i-input></form-item><form-item label="引入JS：" style="margin-bottom:12px"><i-input v-model="listResourceEntity.listCustRefJs" placeholder="引入的脚本:多个通过;分割" type="textarea" :autosize="{minRows: 2,maxRows: 2}"></i-input></form-item><form-item label="备注：" style="margin-bottom:12px"><i-input v-model="listResourceEntity.listCustDesc" type="textarea" :autosize="{minRows: 4,maxRows: 4}"></i-input></form-item></i-form></div></div></tab-pane><tab-pane tab="outer-tabs" name="ExDataSet" label="ExDataSet"></tab-pane><tab-pane tab="outer-tabs" name="BeReferred" label="BeReferred"></tab-pane><tab-pane tab="outer-tabs" name="Config" label="Config"></tab-pane></tabs><div><select-default-value-dialog @on-selected-default-value="onSelectedDefaultValue" ref="selectDefaultValueDialog"></select-default-value-dialog></div></div><script>var IsTopFramePage=!0,listDesign=new Vue({el:"#listDesign",data:{acInterface:{getTablesDataUrl:"/Rest/Builder/DataStorage/DataBase/Table/GetTablesForZTreeNodeList",getPluginsConfig:"/Rest/Builder/HtmlDesign/WebListDesign/GetPluginsConfig",saveDataUrl:"/Rest/Builder/List/SaveEdit",getDataUrl:"/Rest/Builder/List/GetDetailData",getDataSetUrl:"/Rest/Builder/DataSet/DataSetMain/GetDataSetData"},currUserEntity:null,recordId:BaseUtility.GetUrlParaValue("recordId"),listResourceEntity:{listId:"",listCode:"",listName:"",listSingleName:"",listCreateTime:DateUtility.GetCurrentDate(),listUpdateTime:DateUtility.GetCurrentDate(),listUpdater:"",listType:"",listOrderNum:"",listDesc:"",listModuleId:"",listStatus:"启用",listOrganId:"",listOrganName:"",listDatasetId:"",listDatasetName:"",listDatasetPrimaryKey:"ID",listEveryTimeResolve:"否",listEnableSSear:"启用",listEnableCSear:"禁用",listTheme:"ThemeDefault",listCustServerRenderer:"",listCustRefJs:"",listCustClientRenderer:"",listCustDesc:"",listHtmlSource:"",listJsContent:"",listCssContent:"",listConfigContent:"",listDatasetPageSize:20,listIsSystem:"否"},designThemes:[],status:BaseUtility.GetUrlParaValue("op"),oldSelectedTabName:"",selectedTabName:"",storeDataSet:{}},mounted:function(){this.initPageUI(),BaseUtility.SetSystemFavicon()},methods:{selectDefaultValueDialogBegin:function(t,e){this.$refs.selectDefaultValueDialog.beginSelect(e),this.selectDefaultValueTargetWindow=t},onSelectedDefaultValue:function(t){this.selectDefaultValueTargetWindow._SelectBindObj.setSelectEnvVariableResultValue(t)},initPageUI:function(){$(".form-design-wraper").height(PageStyleUtility.GetPageHeight()-60);var i=this;AjaxUtility.Post(this.acInterface.getPluginsConfig,{},function(t){console.log(t),i.designThemes=t.exKVData.designThemes,i.pluginVoList=t.data,DetailPageUtility.BindFormData(i.acInterface.getDataUrl,i.listResourceEntity,i.recordId,i.status,null,function(t){"add"==i.status?(i.listResourceEntity.listType="WebList",i.listResourceEntity.listModuleId=BaseUtility.GetUrlParaValue("moduleId"),i.oldSelectedTabName="Info"):(i.listResourceEntity.listId=BaseUtility.GetUrlParaValue("recordId"),i.oldSelectedTabName="Design",i.selectedTabName="Design");var e=i.getTheme(i.listResourceEntity.listTheme);CKEditorUtility.InitializeCKEditor("html_design",i.pluginVoList,function(){"update"==i.status?(HTMLEditorUtility.SetHTMLEditorHTML(i.listResourceEntity.listHtmlSource),CKEditorUtility.SetCKEditorHTML(i.listResourceEntity.listHtmlSource),JsEditorUtility.SetJsEditorJs(i.listResourceEntity.listJsContent)):JsEditorUtility.SetJsEditorJs('<script>\nvar BuilderListPageRuntimeInstance={\n    data:{\n      listPO:null\n    },\n    pageReady:function(){\n        //页面加载html完成,未进行客户端控件的渲染\n        console.log("页面加载html完成");\n    },\n    rendererChainCompleted:function(){\n        //客户端控件渲染完成.\n        console.log("客户端控件渲染完成");\n    },\n    rendererDataChainCompleted:function(){\n        //客户端控件渲染并绑定完数据.\n        console.log("客户端控件渲染并绑定完数据");\n    }\n}\n<\/script>'),i.isLoading=!1},"../../HTMLDesign/CKEditorConfig/CKEditorConfig.js","../../HTMLDesign/WebListDesign/Plugins/",e)}),HTMLEditorUtility.InitializeHTMLCodeDesign(),JsEditorUtility.InitializeJsCodeDesign(i.status),i.$refs.jsDesignCodeFragment.setJSEditorInstance(JsEditorUtility.GetJsEditorInst())},this)},getTheme:function(t){for(var e=0;e<this.designThemes.length;e++)if(this.designThemes[e].value==t)return this.designThemes[e];return null},changeTheme:function(t){var e=this.getTheme(t);CKEditorUtility.SetThemeVo(e)},isHTMLToOther:function(t){return"HTML"==this.oldSelectedTabName},isDesignToOther:function(t){return"Design"==this.oldSelectedTabName},tabChange:function(t){if(this.isDesignToOther(t)){var e=CKEditorUtility.GetCKEditorHTML();HTMLEditorUtility.SetHTMLEditorHTML(e)}else if(this.isHTMLToOther(t)){e=HTMLEditorUtility.GetHtmlEditorHTML();CKEditorUtility.SetCKEditorHTML(e)}this.oldSelectedTabName=t},selectedDataset:function(t){this.listResourceEntity.listDatasetName=t.text,this.listResourceEntity.listDatasetId=t.id},save:function(t){"HTML"==this.selectedTabName?this.listResourceEntity.listHtmlSource=HTMLEditorUtility.GetHtmlEditorHTML():this.listResourceEntity.listHtmlSource=CKEditorUtility.GetCKEditorHTML(),this.listResourceEntity.listJsContent=JsEditorUtility.GetJsEditorJs();var e=this.validateSaveEnable(this.listResourceEntity);if(e.result){var i=JSON.stringify(this.listResourceEntity);AjaxUtility.PostRequestBody(this.acInterface.saveDataUrl,i,function(e){window.opener._modulelistweblistcomp.reloadData(),"function"==typeof t?t.call(this,e):e.success&&DialogUtility.Alert(window,DialogUtility.DialogId04,{},e.message,function(){if(BaseUtility.IsAddOperation(listDesign.status)){var t="ListDesign.html?op=update&recordId="+e.data.listId+"&timestamp=1609924988586";window.location.href=t}})},this)}else DialogUtility.AlertText(e.msg.join("<br />"))},saveClose:function(){this.save(function(t){t.success&&DialogUtility.Alert(window,DialogUtility.DialogAlertId,{},t.message,function(){DialogUtility.Frame_CloseDialog(window),window.close()})})},savePreview:function(){this.save(function(t){console.log(t);var e=this.listResourceEntity.listId;DialogUtility.Frame_OpenIframeWindow(window,DialogUtility.DialogId04,"ListPreview.html?ListId="+e,{width:0,height:0,title:"列表预览"})})},validateSaveEnable:function(t){var e={result:!0,msg:[]};return""==t.listName&&(e.result=!1,e.msg.push("请填写列表名称!")),e},validateDesign:function(t){this.validateSaveEnable(t)},getDataSet:function(e){if(this.storeDataSet[e])return this.storeDataSet[e];var i=this;return AjaxUtility.PostSync(this.acInterface.getDataSetUrl,{op:"view",recordId:e},function(t){t.success?i.storeDataSet[e]=t.data:DialogUtility.AlertText(t.message)},this),this.storeDataSet[e]}}})</script></body></html>